@page "/profile/{userId:int}"
@using Microsoft.AspNetCore.Mvc.ViewFeatures
@using Microsoft.AspNetCore.Mvc.Rendering
@inject Services.DatabaseServices DBServices
@using DomainModels

@code {
    [Parameter] public int userId { get; set; }

    private UserGetDTO user = new UserGetDTO();

    // List to store bookings associated with the user
    private List<DomainModels.Booking> bookings = new List<DomainModels.Booking>();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            // Attempt to fetch user details by the given userId
            var fetchedUser = await DBServices.GetUserById(userId);

            // Check if a user with the provided ID exists
            if (fetchedUser != null)
            {
                // Assign the fetched user details to the 'user' variable
                user = fetchedUser;

                // Fetch bookings related to the user's email
                bookings = await DBServices.GetBookingsByEmail(user.Email);
            }
            else
            {
                Console.WriteLine("User not found.");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"An unexpected error occurred: {ex.Message}");
        }
    }

   
}

<div class="profile-container">
    <div class="profile-header">
        <div class="profile-info">
            <div class="profile-name">@user.FullName</div>
            <div class="profile-role">@user.Role</div>
        </div>
    </div>

    <div class="profile-content">
        @if (bookings != null)
        {
            <form >
                <ul>
                    @foreach (var booking in bookings)
                    {
                        <li>Room type : @booking.Room.Type</li>
                        <li>Start date : @booking.StartDate.ToString("yyyy-MM-dd")</li>
                        <li>End date : @booking.EndDate.ToString("yyyy-MM-dd")</li>
                        <li>Email : @booking.GuestEmail</li>

                        //this button will transfer you to the EditBookingPage where you can edit the bookings for the user
                        <a href="/editbooking/@booking.BookingId" class="btn btn-primary">Edit Booking</a>

                    }
                </ul>
               
            </form>
        }
        else
        {
            <p>No bookings available.</p>
        }
    </div>
</div>


<style>
  
    .profile-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f4f4f9;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .profile-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .profile-picture {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        overflow: hidden;
        border: 2px solid #007bff;
    }

        .profile-picture img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

    .profile-info {
        flex-grow: 1;
        margin-left: 20px;
    }

    .profile-name {
        font-size: 2em;
        font-weight: bold;
        color: #333;
    }

    .profile-username {
        font-size: 1.2em;
        color: #666;
    }

    .profile-bio {
        margin-top: 10px;
        font-size: 1.1em;
        color: #555;
    }

    .profile-stats {
        margin-top: 20px;
        display: flex;
        justify-content: space-around;
    }

        .profile-stats div {
            text-align: center;
        }

        .profile-stats span {
            display: block;
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
        }

        .profile-stats small {
            color: #777;
        }

    .profile-content {
        margin-top: 40px;
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

</style>